From b0117053e23c60a14a91a7b3b0ee6ed464bbc4e9 Mon Sep 17 00:00:00 2001
From: serafim <serafimcloud@gmail.com>
Date: Fri, 16 Jan 2026 13:59:23 -0800
Subject: [PATCH] Release v0.0.15

---
 .env.example                                  |   4 +
 README.md                                     |   8 +-
 package.json                                  |   3 +-
 src/main/auth-manager.ts                      |  39 ++-
 src/main/auth-store.ts                        |  12 +
 src/main/index.ts                             |   9 +-
 src/main/lib/config.ts                        |  11 +-
 src/main/windows/main.ts                      |  10 +
 src/preload/index.d.ts                        |  87 ++++++-
 src/preload/index.ts                          |   8 +
 src/renderer/App.tsx                          |  19 +-
 .../components/chat-markdown-renderer.tsx     |   3 +-
 .../settings-tabs/agents-debug-tab.tsx        |  67 +++++
 .../settings-tabs/agents-profile-tab.tsx      |  23 +-
 .../settings-tabs/agents-profile-tab.tsx      |  98 ++++----
 .../subchats-quick-switch-dialog.tsx          |   2 +-
 .../features/agents/main/active-chat.tsx      |  33 +--
 .../features/agents/main/new-chat-form.tsx    |  23 +-
 .../mentions/agents-mentions-editor.tsx       | 232 +++++++++++-------
 .../agents/ui/agent-context-indicator.tsx     |  24 +-
 .../features/agents/ui/agents-content.tsx     |  17 +-
 .../features/agents/ui/chat-title-editor.tsx  |   2 +-
 .../features/agents/ui/mobile-chat-header.tsx |   6 +-
 .../features/agents/ui/sub-chat-selector.tsx  |   8 +-
 .../features/agents/utils/auto-rename.ts      |   2 +-
 .../features/agents/utils/paste-text.ts       |  63 +++++
 .../features/sidebar/agents-sidebar.tsx       |  64 ++++-
 .../sidebar/agents-subchats-sidebar.tsx       |  22 +-
 .../features/sub-chats/sub-chat-selector.tsx  |   8 +-
 .../features/sub-chats/sub-chats-sidebar.tsx  |  10 +-
 src/renderer/lib/api-fetch.ts                 |   2 +-
 src/renderer/styles/globals.css               | 122 +++++++++
 32 files changed, 755 insertions(+), 286 deletions(-)
 create mode 100644 src/renderer/features/agents/utils/paste-text.ts

diff --git a/.env.example b/.env.example
index d027df2..4c7643a 100644
--- a/.env.example
+++ b/.env.example
@@ -27,3 +27,7 @@ VITE_POSTHOG_HOST=https://us.i.posthog.com
 # Feedback URL (optional - defaults to open source Discord if not set)
 # Set this in hosted builds to use a private feedback channel
 # VITE_FEEDBACK_URL=https://discord.gg/your-private-invite
+
+# API URL (optional - defaults to https://21st.dev)
+# Only change this if you're running the web app locally
+# MAIN_VITE_API_URL=http://localhost:3000
diff --git a/README.md b/README.md
index 8f65e60..08f8c8e 100644
--- a/README.md
+++ b/README.md
@@ -1,8 +1,10 @@
 # 1Code
 
+[1Code.dev](https://1code.dev)
+
 Best UI for Claude Code with local and remote agent execution.
 
-By [21st.dev](https://21st.dev)
+By [21st.dev](https://21st.dev) team
 
 ## Features
 
@@ -20,10 +22,13 @@ By [21st.dev](https://21st.dev)
 ```bash
 # Prerequisites: Bun, Python, Xcode Command Line Tools (macOS)
 bun install
+bun run claude:download  # Download Claude binary (required!)
 bun run build
 bun run package:mac  # or package:win, package:linux
 ```
 
+> **Important:** The `claude:download` step downloads the Claude CLI binary which is required for the agent chat to work. If you skip this step, the app will build but agent functionality won't work.
+
 ### Option 2: Subscribe to 1code.dev (recommended)
 
 Get pre-built releases + background agents support by subscribing at [1code.dev](https://1code.dev).
@@ -34,6 +39,7 @@ Your subscription helps us maintain and improve 1Code.
 
 ```bash
 bun install
+bun run claude:download  # First time only
 bun run dev
 ```
 
diff --git a/package.json b/package.json
index f3ecc3b..faf6249 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "21st-desktop",
-  "version": "0.0.14",
+  "version": "0.0.15",
   "private": true,
   "description": "1Code - UI for parallel work with AI agents",
   "author": "21st.dev",
@@ -85,6 +85,7 @@
     "react-icons": "^5.5.0",
     "react-markdown": "^10.1.0",
     "react-syntax-highlighter": "^16.1.0",
+    "remark-breaks": "^4.0.0",
     "remark-gfm": "^4.0.1",
     "shiki": "^1.24.4",
     "simple-git": "^3.28.0",
diff --git a/src/main/auth-manager.ts b/src/main/auth-manager.ts
index 6ff1086..6d6338d 100644
--- a/src/main/auth-manager.ts
+++ b/src/main/auth-manager.ts
@@ -1,11 +1,8 @@
 import { AuthStore, AuthData, AuthUser } from "./auth-store"
 import { app, BrowserWindow } from "electron"
 
-// API URLs
-const API_URLS = {
-  production: "https://21st.dev",
-  development: "http://localhost:3000",
-} as const
+// Auth API URL - use env variable for local testing, default to production
+const AUTH_API_URL = import.meta.env.MAIN_VITE_API_URL || "https://21st.dev"
 
 export class AuthManager {
   private store: AuthStore
@@ -32,7 +29,7 @@ export class AuthManager {
   }
 
   private getApiUrl(): string {
-    return this.isDev ? API_URLS.development : API_URLS.production
+    return AUTH_API_URL
   }
 
   /**
@@ -218,4 +215,34 @@ export class AuthManager {
 
     shell.openExternal(authUrl)
   }
+
+  /**
+   * Update user profile on server and locally
+   */
+  async updateUser(updates: { name?: string }): Promise<AuthUser | null> {
+    const token = await this.getValidToken()
+    if (!token) {
+      throw new Error("Not authenticated")
+    }
+
+    // Update on server using X-Desktop-Token header
+    const response = await fetch(`${this.getApiUrl()}/api/user/profile`, {
+      method: "PATCH",
+      headers: {
+        "Content-Type": "application/json",
+        "X-Desktop-Token": token,
+      },
+      body: JSON.stringify({
+        display_name: updates.name,
+      }),
+    })
+
+    if (!response.ok) {
+      const error = await response.json().catch(() => ({ error: "Unknown error" }))
+      throw new Error(error.error || `Update failed: ${response.status}`)
+    }
+
+    // Update locally
+    return this.store.updateUser({ name: updates.name ?? null })
+  }
 }
diff --git a/src/main/auth-store.ts b/src/main/auth-store.ts
index 6d3a830..cd4a388 100644
--- a/src/main/auth-store.ts
+++ b/src/main/auth-store.ts
@@ -187,4 +187,16 @@ export class AuthStore {
     const fiveMinutes = 5 * 60 * 1000
     return expiresAt - Date.now() < fiveMinutes
   }
+
+  /**
+   * Update user data (e.g., after profile update)
+   */
+  updateUser(updates: Partial<AuthUser>): AuthUser | null {
+    const data = this.load()
+    if (!data) return null
+
+    data.user = { ...data.user, ...updates }
+    this.save(data)
+    return data.user
+  }
 }
diff --git a/src/main/index.ts b/src/main/index.ts
index be34ba1..e6e4d8d 100644
--- a/src/main/index.ts
+++ b/src/main/index.ts
@@ -56,10 +56,9 @@ if (app.isPackaged && !IS_DEV) {
 }
 
 // URL configuration (exported for use in other modules)
+// Uses MAIN_VITE_API_URL from .env if set, otherwise defaults to production
 export function getBaseUrl(): string {
-  return process.env.ELECTRON_RENDERER_URL
-    ? "http://localhost:3000"
-    : "https://21st.dev"
+  return import.meta.env.MAIN_VITE_API_URL || "https://21st.dev"
 }
 
 export function getAppUrl(): string {
@@ -487,10 +486,10 @@ if (gotTheLock) {
           label: "File",
           submenu: [
             {
-              label: "New Agent",
+              label: "New Chat",
               accelerator: "CmdOrCtrl+N",
               click: () => {
-                console.log("[Menu] New Agent clicked (Cmd+N)")
+                console.log("[Menu] New Chat clicked (Cmd+N)")
                 const win = getWindow()
                 if (win) {
                   console.log("[Menu] Sending shortcut:new-agent to renderer")
diff --git a/src/main/lib/config.ts b/src/main/lib/config.ts
index 987b697..cc2464e 100644
--- a/src/main/lib/config.ts
+++ b/src/main/lib/config.ts
@@ -2,19 +2,14 @@
  * Shared configuration for the desktop app
  */
 
-// API URLs
-const API_URLS = {
-  production: "https://21st.dev",
-  development: "http://localhost:3000",
-} as const
-
 const IS_DEV = !!process.env.ELECTRON_RENDERER_URL
 
 /**
- * Get the API base URL based on environment
+ * Get the API base URL
+ * Uses MAIN_VITE_API_URL from .env if set, otherwise defaults to production
  */
 export function getApiUrl(): string {
-  return IS_DEV ? API_URLS.development : API_URLS.production
+  return import.meta.env.MAIN_VITE_API_URL || "https://21st.dev"
 }
 
 /**
diff --git a/src/main/windows/main.ts b/src/main/windows/main.ts
index d970d27..d593867 100644
--- a/src/main/windows/main.ts
+++ b/src/main/windows/main.ts
@@ -179,6 +179,16 @@ function registerIpcHandlers(getWindow: () => BrowserWindow | null): void {
     }
     await handleAuthCode(code)
   })
+
+  ipcMain.handle("auth:update-user", async (event, updates: { name?: string }) => {
+    if (!validateSender(event)) return null
+    try {
+      return await getAuthManager().updateUser(updates)
+    } catch (error) {
+      console.error("[Auth] Failed to update user:", error)
+      throw error
+    }
+  })
 }
 
 // Current window reference
diff --git a/src/preload/index.d.ts b/src/preload/index.d.ts
index fdecde0..51a06b4 100644
--- a/src/preload/index.d.ts
+++ b/src/preload/index.d.ts
@@ -1,23 +1,90 @@
+export interface UpdateInfo {
+  version: string
+  releaseDate?: string
+}
+
+export interface UpdateProgress {
+  percent: number
+  bytesPerSecond: number
+  transferred: number
+  total: number
+}
+
+export interface DesktopUser {
+  id: string
+  email: string
+  name: string | null
+  imageUrl: string | null
+  username: string | null
+}
+
 export interface DesktopApi {
+  // Platform info
+  platform: NodeJS.Platform
+  arch: string
   getVersion: () => Promise<string>
-  checkUpdate: () => Promise<{ version: string; downloadUrl: string } | null>
-  getPlatform: () => Promise<NodeJS.Platform>
-  getUser: () => Promise<{
-    id: string
-    email: string
-    name: string | null
-    imageUrl: string | null
-    username: string | null
-  } | null>
+
+  // Auto-update
+  checkForUpdates: () => Promise<UpdateInfo | null>
+  downloadUpdate: () => Promise<boolean>
+  installUpdate: () => void
+  onUpdateChecking: (callback: () => void) => () => void
+  onUpdateAvailable: (callback: (info: UpdateInfo) => void) => () => void
+  onUpdateNotAvailable: (callback: () => void) => () => void
+  onUpdateProgress: (callback: (progress: UpdateProgress) => void) => () => void
+  onUpdateDownloaded: (callback: (info: UpdateInfo) => void) => () => void
+  onUpdateError: (callback: (error: string) => void) => () => void
+  onUpdateManualCheck: (callback: () => void) => () => void
+
+  // Window controls
+  windowMinimize: () => Promise<void>
+  windowMaximize: () => Promise<void>
+  windowClose: () => Promise<void>
+  windowIsMaximized: () => Promise<boolean>
+  windowToggleFullscreen: () => Promise<void>
+  windowIsFullscreen: () => Promise<boolean>
+  setTrafficLightVisibility: (visible: boolean) => Promise<void>
+  onFullscreenChange: (callback: (isFullscreen: boolean) => void) => () => void
+  onFocusChange: (callback: (isFocused: boolean) => void) => () => void
+
+  // Zoom
+  zoomIn: () => Promise<void>
+  zoomOut: () => Promise<void>
+  zoomReset: () => Promise<void>
+  getZoom: () => Promise<number>
+
+  // DevTools
+  toggleDevTools: () => Promise<void>
+
+  // Analytics
+  setAnalyticsOptOut: (optedOut: boolean) => Promise<void>
+
+  // Native features
+  setBadge: (count: number | null) => Promise<void>
+  showNotification: (options: { title: string; body: string }) => Promise<void>
+  openExternal: (url: string) => Promise<void>
+  getApiBaseUrl: () => Promise<string>
+
+  // Clipboard
+  clipboardWrite: (text: string) => Promise<void>
+  clipboardRead: () => Promise<string>
+
+  // Auth
+  getUser: () => Promise<DesktopUser | null>
   isAuthenticated: () => Promise<boolean>
   logout: () => Promise<void>
   startAuthFlow: () => Promise<void>
+  submitAuthCode: (code: string) => Promise<void>
+  updateUser: (updates: { name?: string }) => Promise<DesktopUser | null>
   onAuthSuccess: (callback: (user: any) => void) => () => void
   onAuthError: (callback: (error: string) => void) => () => void
+
+  // Shortcuts
+  onShortcutNewAgent: (callback: () => void) => () => void
 }
 
 declare global {
   interface Window {
-    desktopApi?: DesktopApi
+    desktopApi: DesktopApi
   }
 }
diff --git a/src/preload/index.ts b/src/preload/index.ts
index 6b30a33..3b68ef4 100644
--- a/src/preload/index.ts
+++ b/src/preload/index.ts
@@ -118,6 +118,7 @@ contextBridge.exposeInMainWorld("desktopApi", {
   logout: () => ipcRenderer.invoke("auth:logout"),
   startAuthFlow: () => ipcRenderer.invoke("auth:start-flow"),
   submitAuthCode: (code: string) => ipcRenderer.invoke("auth:submit-code", code),
+  updateUser: (updates: { name?: string }) => ipcRenderer.invoke("auth:update-user", updates),
 
   // Auth events
   onAuthSuccess: (callback: (user: any) => void) => {
@@ -201,6 +202,13 @@ export interface DesktopApi {
   logout: () => Promise<void>
   startAuthFlow: () => Promise<void>
   submitAuthCode: (code: string) => Promise<void>
+  updateUser: (updates: { name?: string }) => Promise<{
+    id: string
+    email: string
+    name: string | null
+    imageUrl: string | null
+    username: string | null
+  } | null>
   onAuthSuccess: (callback: (user: any) => void) => () => void
   onAuthError: (callback: (error: string) => void) => () => void
   // Shortcuts
diff --git a/src/renderer/App.tsx b/src/renderer/App.tsx
index d344125..ec33401 100644
--- a/src/renderer/App.tsx
+++ b/src/renderer/App.tsx
@@ -1,6 +1,7 @@
 import { useEffect, useMemo } from "react"
 import { Provider as JotaiProvider, useAtomValue } from "jotai"
-import { ThemeProvider } from "next-themes"
+import { ThemeProvider, useTheme } from "next-themes"
+import { Toaster } from "sonner"
 import { TRPCProvider } from "./contexts/TRPCProvider"
 import { AgentsLayout } from "./features/layout/agents-layout"
 import {
@@ -15,6 +16,21 @@ import { anthropicOnboardingCompletedAtom } from "./lib/atoms"
 import { selectedProjectAtom } from "./features/agents/atoms"
 import { trpc } from "./lib/trpc"
 
+/**
+ * Custom Toaster that adapts to theme
+ */
+function ThemedToaster() {
+  const { resolvedTheme } = useTheme()
+
+  return (
+    <Toaster
+      position="bottom-right"
+      theme={resolvedTheme as "light" | "dark" | "system"}
+      closeButton
+    />
+  )
+}
+
 /**
  * Main content router - decides which page to show based on onboarding state
  */
@@ -102,6 +118,7 @@ export function App() {
               >
                 <AppContent />
               </div>
+              <ThemedToaster />
             </TRPCProvider>
           </TooltipProvider>
         </VSCodeThemeProvider>
diff --git a/src/renderer/components/chat-markdown-renderer.tsx b/src/renderer/components/chat-markdown-renderer.tsx
index 70b2f57..bc2331c 100644
--- a/src/renderer/components/chat-markdown-renderer.tsx
+++ b/src/renderer/components/chat-markdown-renderer.tsx
@@ -2,6 +2,7 @@ import { cn } from "../lib/utils"
 import { memo, useMemo, useState, useCallback, useEffect } from "react"
 import ReactMarkdown from "react-markdown"
 import remarkGfm from "remark-gfm"
+import remarkBreaks from "remark-breaks"
 import { Copy, Check } from "lucide-react"
 import { useCodeTheme } from "../lib/hooks/use-code-theme"
 import { highlightCode } from "../lib/themes/shiki-theme-loader"
@@ -450,7 +451,7 @@ export const ChatMarkdownRenderer = memo(function ChatMarkdownRenderer({
         className,
       )}
     >
-      <ReactMarkdown remarkPlugins={[remarkGfm]} components={components}>
+      <ReactMarkdown remarkPlugins={[remarkGfm, remarkBreaks]} components={components}>
         {processedContent}
       </ReactMarkdown>
     </div>
diff --git a/src/renderer/components/dialogs/settings-tabs/agents-debug-tab.tsx b/src/renderer/components/dialogs/settings-tabs/agents-debug-tab.tsx
index 7f8d433..a56479d 100644
--- a/src/renderer/components/dialogs/settings-tabs/agents-debug-tab.tsx
+++ b/src/renderer/components/dialogs/settings-tabs/agents-debug-tab.tsx
@@ -203,6 +203,73 @@ export function AgentsDebugTab() {
         </div>
       </div>
 
+      {/* Toast Testing */}
+      <div className="space-y-3">
+        <h4 className="text-sm font-medium text-muted-foreground uppercase tracking-wide">
+          Toast Testing
+        </h4>
+        <div className="grid grid-cols-2 gap-2">
+          <Button
+            variant="outline"
+            size="sm"
+            onClick={() =>
+              toast.info("Cancelation sent", {
+                description: "Sent to John Smith",
+                action: {
+                  label: "Undo",
+                  onClick: () => toast("Undone!"),
+                },
+              })
+            }
+          >
+            Info + Undo
+          </Button>
+          <Button
+            variant="outline"
+            size="sm"
+            onClick={() => toast.success("Success!", { description: "Operation completed" })}
+          >
+            Success
+          </Button>
+          <Button
+            variant="outline"
+            size="sm"
+            onClick={() => toast.error("Error", { description: "Something went wrong" })}
+          >
+            Error
+          </Button>
+          <Button
+            variant="outline"
+            size="sm"
+            onClick={() => toast("Default toast", { description: "This is a description" })}
+          >
+            Default
+          </Button>
+          <Button
+            variant="outline"
+            size="sm"
+            onClick={() => {
+              const id = toast.loading("Loading...", { description: "Please wait" })
+              setTimeout(() => toast.dismiss(id), 3000)
+            }}
+          >
+            Loading
+          </Button>
+          <Button
+            variant="outline"
+            size="sm"
+            onClick={() => {
+              const id = toast.loading("Processing...")
+              setTimeout(() => {
+                toast.success("Done!", { id })
+              }, 2000)
+            }}
+          >
+            Promise
+          </Button>
+        </div>
+      </div>
+
       {/* Data Management */}
       <div className="space-y-3">
         <h4 className="text-sm font-medium text-muted-foreground uppercase tracking-wide">
diff --git a/src/renderer/components/dialogs/settings-tabs/agents-profile-tab.tsx b/src/renderer/components/dialogs/settings-tabs/agents-profile-tab.tsx
index 9c66e9c..e280dad 100644
--- a/src/renderer/components/dialogs/settings-tabs/agents-profile-tab.tsx
+++ b/src/renderer/components/dialogs/settings-tabs/agents-profile-tab.tsx
@@ -3,6 +3,7 @@ import { Button } from "../../ui/button"
 import { Input } from "../../ui/input"
 import { Label } from "../../ui/label"
 import { IconSpinner } from "../../../icons"
+import { toast } from "sonner"
 
 // Hook to detect narrow screen
 function useIsNarrowScreen(): boolean {
@@ -51,10 +52,24 @@ export function AgentsProfileTab() {
 
   const handleSave = async () => {
     setIsSaving(true)
-    // Simulate API call
-    await new Promise((resolve) => setTimeout(resolve, 1000))
-    setIsSaving(false)
-    console.log("Mock: Profile saved", { fullName })
+    try {
+      if (window.desktopApi?.updateUser) {
+        const updatedUser = await window.desktopApi.updateUser({ name: fullName })
+        if (updatedUser) {
+          setUser(updatedUser)
+          toast.success("Profile updated successfully")
+        }
+      } else {
+        throw new Error("Desktop API not available")
+      }
+    } catch (error) {
+      console.error("Error updating profile:", error)
+      toast.error(
+        error instanceof Error ? error.message : "Failed to update profile"
+      )
+    } finally {
+      setIsSaving(false)
+    }
   }
 
   if (isLoading) {
diff --git a/src/renderer/features/agents/components/settings-tabs/agents-profile-tab.tsx b/src/renderer/features/agents/components/settings-tabs/agents-profile-tab.tsx
index d2aadc1..d646b90 100644
--- a/src/renderer/features/agents/components/settings-tabs/agents-profile-tab.tsx
+++ b/src/renderer/features/agents/components/settings-tabs/agents-profile-tab.tsx
@@ -4,36 +4,47 @@ import { useState, useEffect, useRef } from "react"
 import { Button } from "../../../../components/ui/button"
 import { Input } from "../../../../components/ui/input"
 import { Label } from "../../../../components/ui/label"
-// Desktop: stub for user profile hooks
-const useUserProfile = () => ({
-  clerkUser: {
-    fullName: "Demo User",
-    imageUrl: null as string | null,
-    externalAccounts: [{ provider: "github", username: "demo-user" }],
-  },
-  user: {
-    display_name: "Demo User",
-    display_image_url: null as string | null,
-    fullName: "Demo User",
-    imageUrl: null as string | null,
-    externalAccounts: [{ provider: "github", username: "demo-user" }],
-  },
-  isLoading: false,
-})
-const UserAvatar = ({ user, className }: any) => null
-import { ClaudeCodeLogoIcon } from "../../../../components/ui/icons"
+import { ClaudeCodeLogoIcon, IconSpinner } from "../../../../components/ui/icons"
 import { toast } from "sonner"
-// Desktop: stub for image upload
+import { Upload, Edit } from "lucide-react"
+import { motion } from "motion/react"
+import { cn } from "../../../../lib/utils"
+
+// Desktop user interface
+interface DesktopUser {
+  id: string
+  email: string
+  name: string | null
+  imageUrl: string | null
+  username: string | null
+}
+
+// Custom hook for desktop user profile
+const useDesktopUserProfile = () => {
+  const [user, setUser] = useState<DesktopUser | null>(null)
+  const [isLoading, setIsLoading] = useState(true)
+
+  useEffect(() => {
+    async function fetchUser() {
+      if (window.desktopApi?.getUser) {
+        const userData = await window.desktopApi.getUser()
+        setUser(userData)
+      }
+      setIsLoading(false)
+    }
+    fetchUser()
+  }, [])
+
+  return { user, setUser, isLoading }
+}
+
+// Stub for image upload (not implemented in desktop yet)
 const useImageUpload = () => ({
   previewUrl: null as string | null,
   fileInputRef: { current: null as HTMLInputElement | null },
   handleThumbnailClick: () => {},
   handleFileChange: async (_event?: unknown) => null as string | null
 })
-import { IconSpinner } from "../../../../components/ui/icons"
-import { Upload, Edit, X } from "lucide-react"
-import { motion } from "motion/react"
-import { cn } from "../../../../lib/utils"
 // Desktop uses mock data instead of trpc
 // eslint-disable-next-line @typescript-eslint/no-explicit-any
 type AnyFn = (...args: any[]) => any
@@ -99,11 +110,7 @@ type AuthFlowState =
   | { step: "error"; message: string }
 
 export function AgentsProfileTab() {
-  const {
-    clerkUser: user,
-    user: dbUser,
-    isLoading: isUserLoading,
-  } = useUserProfile()
+  const { user, setUser, isLoading: isUserLoading } = useDesktopUserProfile()
   const [fullName, setFullName] = useState("")
   const [profileImage, setProfileImage] = useState("")
   const [isSaving, setIsSaving] = useState(false)
@@ -113,11 +120,11 @@ export function AgentsProfileTab() {
 
   // Initialize state when user data is loaded
   useEffect(() => {
-    if (!isUserLoading && (dbUser || user)) {
-      setFullName(dbUser?.display_name || user?.fullName || "")
-      setProfileImage(dbUser?.display_image_url || user?.imageUrl || "")
+    if (!isUserLoading && user) {
+      setFullName(user.name || "")
+      setProfileImage(user.imageUrl || "")
     }
-  }, [isUserLoading, dbUser, user])
+  }, [isUserLoading, user])
 
   // Update profileImage when previewUrl changes
   useEffect(() => {
@@ -130,23 +137,15 @@ export function AgentsProfileTab() {
     setIsSaving(true)
 
     try {
-      const response = await fetch("/api/user/profile", {
-        method: "PATCH",
-        headers: {
-          "Content-Type": "application/json",
-        },
-        body: JSON.stringify({
-          display_name: fullName || null,
-          display_image_url: profileImage || null,
-        }),
-      })
-
-      if (!response.ok) {
-        const result = await response.json()
-        throw new Error(result.error || "Failed to update profile")
+      if (window.desktopApi?.updateUser) {
+        const updatedUser = await window.desktopApi.updateUser({ name: fullName })
+        if (updatedUser) {
+          setUser(updatedUser)
+          toast.success("Profile updated successfully")
+        }
+      } else {
+        throw new Error("Desktop API not available")
       }
-
-      toast.success("Profile updated successfully")
     } catch (error) {
       console.error("Error updating profile:", error)
       toast.error(
@@ -382,8 +381,7 @@ export function AgentsProfileTab() {
     )
   }
 
-  const currentImageUrl =
-    previewUrl || profileImage || dbUser?.display_image_url || user?.imageUrl
+  const currentImageUrl = previewUrl || profileImage || user?.imageUrl
 
   return (
     <div className="p-6 space-y-6">
diff --git a/src/renderer/features/agents/components/subchats-quick-switch-dialog.tsx b/src/renderer/features/agents/components/subchats-quick-switch-dialog.tsx
index 8a47941..5e82d5c 100644
--- a/src/renderer/features/agents/components/subchats-quick-switch-dialog.tsx
+++ b/src/renderer/features/agents/components/subchats-quick-switch-dialog.tsx
@@ -110,7 +110,7 @@ function SubChatCard({
               isSelected ? "text-primary-foreground" : "text-foreground",
             )}
           >
-            {subChat.name || "New Agent"}
+            {subChat.name || "New Chat"}
           </span>
           {/* Time and stats */}
           <div className="flex items-center gap-1.5 text-[11px]">
diff --git a/src/renderer/features/agents/main/active-chat.tsx b/src/renderer/features/agents/main/active-chat.tsx
index 5ac1722..3140ba9 100644
--- a/src/renderer/features/agents/main/active-chat.tsx
+++ b/src/renderer/features/agents/main/active-chat.tsx
@@ -158,6 +158,7 @@ import { PrStatusBar } from "../ui/pr-status-bar"
 import { SubChatSelector } from "../ui/sub-chat-selector"
 import { SubChatStatusCard } from "../ui/sub-chat-status-card"
 import { autoRenameAgentChat } from "../utils/auto-rename"
+import { handlePasteEvent } from "../utils/paste-text"
 import { generateCommitToPrMessage, generatePrMessage, generateReviewMessage } from "../utils/pr-message"
 import {
   saveSubChatDraft,
@@ -858,7 +859,7 @@ function ChatViewInner({
         // Revert on error (toast shown by mutation onError)
         useAgentSubChatStore
           .getState()
-          .updateSubChatName(subChatId, subChatName || "New Agent")
+          .updateSubChatName(subChatId, subChatName || "New Chat")
       }
     },
     [subChatId, subChatName, renameSubChatMutation],
@@ -1834,25 +1835,9 @@ function ChatViewInner({
   )
 
   // Paste handler for images and plain text
+  // Uses async text insertion to prevent UI freeze with large text
   const handlePaste = useCallback(
-    (e: React.ClipboardEvent) => {
-      const files = Array.from(e.clipboardData.items)
-        .filter((item) => item.type.startsWith("image/"))
-        .map((item) => item.getAsFile())
-        .filter(Boolean) as File[]
-
-      if (files.length > 0) {
-        e.preventDefault()
-        handleAddAttachments(files)
-      } else {
-        // Paste as plain text only (prevents HTML from being pasted)
-        const text = e.clipboardData.getData("text/plain")
-        if (text) {
-          e.preventDefault()
-          document.execCommand("insertText", false, text)
-        }
-      }
-    },
+    (e: React.ClipboardEvent) => handlePasteEvent(e, handleAddAttachments),
     [handleAddAttachments],
   )
 
@@ -1973,7 +1958,7 @@ function ChatViewInner({
         >
           <ChatTitleEditor
             name={subChatName}
-            placeholder="New Agent"
+            placeholder="New Chat"
             onSave={handleRenameSubChat}
             isMobile={false}
             chatId={subChatId}
@@ -3722,7 +3707,7 @@ export function ChatView({
           : sc.updated_at?.toISOString()
       return {
         id: sc.id,
-        name: sc.name || "New Agent",
+        name: sc.name || "New Chat",
         // Prefer DB timestamp, fall back to local timestamp, then current time
         created_at:
           createdAt ?? existingLocal?.created_at ?? new Date().toISOString(),
@@ -3745,7 +3730,7 @@ export function ChatView({
       if (!dbSubChatIds.has(id)) {
         allSubChats.push({
           id,
-          name: "New Agent",
+          name: "New Chat",
           created_at: new Date().toISOString(),
         })
       }
@@ -3898,7 +3883,7 @@ export function ChatView({
     // Create sub-chat in DB first to get the real ID
     const newSubChat = await trpcClient.chats.createSubChat.mutate({
       chatId,
-      name: "New Agent",
+      name: "New Chat",
       mode: subChatMode,
     })
     const newId = newSubChat.id
@@ -3909,7 +3894,7 @@ export function ChatView({
     // Add to allSubChats with placeholder name
     store.addToAllSubChats({
       id: newId,
-      name: "New Agent",
+      name: "New Chat",
       created_at: new Date().toISOString(),
       mode: subChatMode,
     })
diff --git a/src/renderer/features/agents/main/new-chat-form.tsx b/src/renderer/features/agents/main/new-chat-form.tsx
index 7c4ccb1..976ed21 100644
--- a/src/renderer/features/agents/main/new-chat-form.tsx
+++ b/src/renderer/features/agents/main/new-chat-form.tsx
@@ -79,6 +79,7 @@ import { agentsSidebarOpenAtom, agentsUnseenChangesAtom } from "../atoms"
 import { AgentSendButton } from "../components/agent-send-button"
 import { CreateBranchDialog } from "../components/create-branch-dialog"
 import { formatTimeAgo } from "../utils/format-time-ago"
+import { handlePasteEvent } from "../utils/paste-text"
 import {
   loadGlobalDrafts,
   saveGlobalDrafts,
@@ -442,7 +443,7 @@ export function NewChatForm({
     setSelectedBranch,
   ])
 
-  // Auto-focus input when NewChatForm is shown (when clicking "New Agent")
+  // Auto-focus input when NewChatForm is shown (when clicking "New Chat")
   // Skip on mobile to prevent keyboard from opening automatically
   useEffect(() => {
     if (isMobileFullscreen) return // Don't autofocus on mobile
@@ -801,25 +802,9 @@ export function NewChatForm({
   )
 
   // Paste handler for images and plain text
+  // Uses async text insertion to prevent UI freeze with large text
   const handlePaste = useCallback(
-    (e: React.ClipboardEvent) => {
-      const files = Array.from(e.clipboardData.items)
-        .filter((item) => item.type.startsWith("image/"))
-        .map((item) => item.getAsFile())
-        .filter(Boolean) as File[]
-
-      if (files.length > 0) {
-        e.preventDefault()
-        handleAddAttachments(files)
-      } else {
-        // Paste as plain text only (prevents HTML from being pasted)
-        const text = e.clipboardData.getData("text/plain")
-        if (text) {
-          e.preventDefault()
-          document.execCommand("insertText", false, text)
-        }
-      }
-    },
+    (e: React.ClipboardEvent) => handlePasteEvent(e, handleAddAttachments),
     [handleAddAttachments],
   )
 
diff --git a/src/renderer/features/agents/mentions/agents-mentions-editor.tsx b/src/renderer/features/agents/mentions/agents-mentions-editor.tsx
index 4f3a301..e9db20a 100644
--- a/src/renderer/features/agents/mentions/agents-mentions-editor.tsx
+++ b/src/renderer/features/agents/mentions/agents-mentions-editor.tsx
@@ -9,9 +9,29 @@ import {
   useRef,
   useState,
   memo,
+  useMemo,
 } from "react"
 import { createFileIconElement } from "./agents-file-mention"
 
+// Debounce utility for performance optimization
+function debounce<T extends (...args: Parameters<T>) => void>(
+  fn: T,
+  delay: number,
+): { (...args: Parameters<T>): void; cancel: () => void } {
+  let timeoutId: ReturnType<typeof setTimeout> | null = null
+  const debouncedFn = (...args: Parameters<T>) => {
+    if (timeoutId) clearTimeout(timeoutId)
+    timeoutId = setTimeout(() => fn(...args), delay)
+  }
+  debouncedFn.cancel = () => {
+    if (timeoutId) clearTimeout(timeoutId)
+  }
+  return debouncedFn
+}
+
+// Threshold for skipping expensive trigger detection (characters)
+const LARGE_TEXT_THRESHOLD = 50000
+
 export interface FileMentionOption {
   id: string // file:owner/repo:path/to/file.tsx or folder:owner/repo:path/to/folder or skill:skill-name
   label: string // filename or folder name or skill name
@@ -527,108 +547,140 @@ export const AgentsMentionsEditor = memo(
         }
       }, [])
 
-      // Handle input - UNCONTROLLED: no onChange, just @ and / trigger detection
-      const handleInput = useCallback(() => {
-        if (!editorRef.current) return
+      // Debounced trigger detection for performance (expensive tree walk)
+      const debouncedTriggerDetection = useMemo(
+        () =>
+          debounce(() => {
+            if (!editorRef.current) return
 
-        // Update placeholder visibility and notify parent
-        // Use textContent without trim() so placeholder hides even with just spaces
-        const content = editorRef.current.textContent
-        const newHasContent = !!content
-        setHasContent(newHasContent)
-        onContentChange?.(newHasContent)
+            const content = editorRef.current.textContent || ""
 
-        // Get selection for cursor position
-        const sel = window.getSelection()
-        const range = sel && sel.rangeCount > 0 ? sel.getRangeAt(0) : null
+            // Skip expensive trigger detection for very large text
+            // This prevents UI freeze when pasting large content
+            if (content.length > LARGE_TEXT_THRESHOLD) {
+              // Close any open triggers since we can't detect them
+              if (triggerActive.current) {
+                triggerActive.current = false
+                triggerStartIndex.current = null
+                onCloseTrigger()
+              }
+              if (slashTriggerActive.current) {
+                slashTriggerActive.current = false
+                slashTriggerStartIndex.current = null
+                onCloseSlashTrigger?.()
+              }
+              return
+            }
 
-        // Handle non-collapsed selection (close triggers)
-        if (range && !range.collapsed) {
-          if (triggerActive.current) {
-            triggerActive.current = false
-            triggerStartIndex.current = null
-            onCloseTrigger()
-          }
-          if (slashTriggerActive.current) {
-            slashTriggerActive.current = false
-            slashTriggerStartIndex.current = null
-            onCloseSlashTrigger?.()
-          }
-          return
-        }
+            // Get selection for cursor position
+            const sel = window.getSelection()
+            const range = sel && sel.rangeCount > 0 ? sel.getRangeAt(0) : null
+
+            // Handle non-collapsed selection (close triggers)
+            if (range && !range.collapsed) {
+              if (triggerActive.current) {
+                triggerActive.current = false
+                triggerStartIndex.current = null
+                onCloseTrigger()
+              }
+              if (slashTriggerActive.current) {
+                slashTriggerActive.current = false
+                slashTriggerStartIndex.current = null
+                onCloseSlashTrigger?.()
+              }
+              return
+            }
 
-        // Single tree walk for @ and / trigger detection
-        const {
-          textBeforeCursor,
-          atPosition,
-          atIndex,
-          slashPosition,
-          slashIndex,
-        } = walkTreeOnce(editorRef.current, range)
-
-        // Handle @ trigger (takes priority over /)
-        if (atIndex !== -1 && atPosition) {
-          triggerActive.current = true
-          triggerStartIndex.current = atIndex
-
-          // Close slash trigger if active
-          if (slashTriggerActive.current) {
-            slashTriggerActive.current = false
-            slashTriggerStartIndex.current = null
-            onCloseSlashTrigger?.()
-          }
+            // Single tree walk for @ and / trigger detection
+            const {
+              textBeforeCursor,
+              atPosition,
+              atIndex,
+              slashPosition,
+              slashIndex,
+            } = walkTreeOnce(editorRef.current, range)
+
+            // Handle @ trigger (takes priority over /)
+            if (atIndex !== -1 && atPosition) {
+              triggerActive.current = true
+              triggerStartIndex.current = atIndex
+
+              // Close slash trigger if active
+              if (slashTriggerActive.current) {
+                slashTriggerActive.current = false
+                slashTriggerStartIndex.current = null
+                onCloseSlashTrigger?.()
+              }
 
-          const afterAt = textBeforeCursor.slice(atIndex + 1)
+              const afterAt = textBeforeCursor.slice(atIndex + 1)
 
-          // Get position for dropdown
-          if (atPosition.node.nodeType === Node.TEXT_NODE) {
-            const tempRange = document.createRange()
-            tempRange.setStart(atPosition.node, atPosition.offset)
-            tempRange.setEnd(atPosition.node, atPosition.offset + 1)
-            const rect = tempRange.getBoundingClientRect()
-            onTrigger({ searchText: afterAt, rect })
-            return
-          }
-        }
+              // Get position for dropdown
+              if (atPosition.node.nodeType === Node.TEXT_NODE) {
+                const tempRange = document.createRange()
+                tempRange.setStart(atPosition.node, atPosition.offset)
+                tempRange.setEnd(atPosition.node, atPosition.offset + 1)
+                const rect = tempRange.getBoundingClientRect()
+                onTrigger({ searchText: afterAt, rect })
+                return
+              }
+            }
 
-        // Close @ trigger if no @ found
-        if (triggerActive.current) {
-          triggerActive.current = false
-          triggerStartIndex.current = null
-          onCloseTrigger()
-        }
+            // Close @ trigger if no @ found
+            if (triggerActive.current) {
+              triggerActive.current = false
+              triggerStartIndex.current = null
+              onCloseTrigger()
+            }
 
-        // Handle / trigger (only if @ trigger is not active)
-        if (slashIndex !== -1 && slashPosition && onSlashTrigger) {
-          slashTriggerActive.current = true
-          slashTriggerStartIndex.current = slashIndex
+            // Handle / trigger (only if @ trigger is not active)
+            if (slashIndex !== -1 && slashPosition && onSlashTrigger) {
+              slashTriggerActive.current = true
+              slashTriggerStartIndex.current = slashIndex
 
-          const afterSlash = textBeforeCursor.slice(slashIndex + 1)
+              const afterSlash = textBeforeCursor.slice(slashIndex + 1)
 
-          // Get position for dropdown
-          if (slashPosition.node.nodeType === Node.TEXT_NODE) {
-            const tempRange = document.createRange()
-            tempRange.setStart(slashPosition.node, slashPosition.offset)
-            tempRange.setEnd(slashPosition.node, slashPosition.offset + 1)
-            const rect = tempRange.getBoundingClientRect()
-            onSlashTrigger({ searchText: afterSlash, rect })
-            return
-          }
-        }
+              // Get position for dropdown
+              if (slashPosition.node.nodeType === Node.TEXT_NODE) {
+                const tempRange = document.createRange()
+                tempRange.setStart(slashPosition.node, slashPosition.offset)
+                tempRange.setEnd(slashPosition.node, slashPosition.offset + 1)
+                const rect = tempRange.getBoundingClientRect()
+                onSlashTrigger({ searchText: afterSlash, rect })
+                return
+              }
+            }
+
+            // Close / trigger if no / found
+            if (slashTriggerActive.current) {
+              slashTriggerActive.current = false
+              slashTriggerStartIndex.current = null
+              onCloseSlashTrigger?.()
+            }
+          }, 16), // ~1 frame delay for debounce
+        [onTrigger, onCloseTrigger, onSlashTrigger, onCloseSlashTrigger],
+      )
 
-        // Close / trigger if no / found
-        if (slashTriggerActive.current) {
-          slashTriggerActive.current = false
-          slashTriggerStartIndex.current = null
-          onCloseSlashTrigger?.()
+      // Cleanup debounce on unmount
+      useEffect(() => {
+        return () => {
+          debouncedTriggerDetection.cancel()
         }
-      }, [
-        onTrigger,
-        onCloseTrigger,
-        onSlashTrigger,
-        onCloseSlashTrigger,
-        onContentChange,
-      ])
+      }, [debouncedTriggerDetection])
+
+      // Handle input - UNCONTROLLED: no onChange, just @ and / trigger detection
+      const handleInput = useCallback(() => {
+        if (!editorRef.current) return
+
+        // Update placeholder visibility and notify parent IMMEDIATELY (cheap operation)
+        // Use textContent without trim() so placeholder hides even with just spaces
+        const content = editorRef.current.textContent
+        const newHasContent = !!content
+        setHasContent(newHasContent)
+        onContentChange?.(newHasContent)
+
+        // Debounce the expensive trigger detection
+        debouncedTriggerDetection()
+      }, [onContentChange, debouncedTriggerDetection])
 
       // Handle keydown
       const handleKeyDown = useCallback(
diff --git a/src/renderer/features/agents/ui/agent-context-indicator.tsx b/src/renderer/features/agents/ui/agent-context-indicator.tsx
index 63b8d62..7b34765 100644
--- a/src/renderer/features/agents/ui/agent-context-indicator.tsx
+++ b/src/renderer/features/agents/ui/agent-context-indicator.tsx
@@ -40,15 +40,11 @@ function CircularProgress({
   size = 18,
   strokeWidth = 2,
   className,
-  isCritical,
-  isNearingLimit,
 }: {
   percent: number
   size?: number
   strokeWidth?: number
   className?: string
-  isCritical?: boolean
-  isNearingLimit?: boolean
 }) {
   const radius = (size - strokeWidth) / 2
   const circumference = 2 * Math.PI * radius
@@ -81,14 +77,7 @@ function CircularProgress({
         strokeDasharray={circumference}
         strokeDashoffset={offset}
         strokeLinecap="round"
-        className={cn(
-          "transition-all duration-300",
-          isCritical
-            ? "text-rose-500"
-            : isNearingLimit
-              ? "text-amber-500"
-              : "text-muted-foreground/60",
-        )}
+        className="transition-all duration-300 text-muted-foreground/60"
       />
     </svg>
   )
@@ -129,9 +118,6 @@ export const AgentContextIndicator = memo(function AgentContextIndicator({
     (sessionTotals.totalTokens / contextWindow) * 100,
   )
 
-  // Determine warning levels
-  const isNearingLimit = percentUsed >= 75
-  const isCritical = percentUsed >= 90
   const isEmpty = sessionTotals.totalTokens === 0
 
   return (
@@ -143,13 +129,7 @@ export const AgentContextIndicator = memo(function AgentContextIndicator({
             className,
           )}
         >
-          <CircularProgress
-            percent={percentUsed}
-            size={14}
-            strokeWidth={2.5}
-            isCritical={isCritical}
-            isNearingLimit={isNearingLimit}
-          />
+          <CircularProgress percent={percentUsed} size={14} strokeWidth={2.5} />
         </div>
       </TooltipTrigger>
       <TooltipContent side="top" sideOffset={8}>
diff --git a/src/renderer/features/agents/ui/agents-content.tsx b/src/renderer/features/agents/ui/agents-content.tsx
index 9be2e1e..1e907d3 100644
--- a/src/renderer/features/agents/ui/agents-content.tsx
+++ b/src/renderer/features/agents/ui/agents-content.tsx
@@ -485,6 +485,7 @@ export function AgentsContent() {
 
   // Get open sub-chats for quick-switch (only tabs that are open in the selector)
   // Sorted by position in openSubChatIds, with active first
+  // Limited to 5 items for quick-switch dialog
   const recentSubChats = useMemo(() => {
     if (!openSubChatIds || openSubChatIds.length === 0) return []
 
@@ -495,13 +496,13 @@ export function AgentsContent() {
 
     if (openSubChats.length === 0) return []
 
-    // Put active sub-chat first, keep rest in tab order
+    // Put active sub-chat first, keep rest in tab order, limit to 5
     if (activeSubChatId) {
       const activeChat = openSubChats.find((c) => c.id === activeSubChatId)
-      const otherChats = openSubChats.filter((c) => c.id !== activeSubChatId)
-      return activeChat ? [activeChat, ...otherChats] : openSubChats
+      const otherChats = openSubChats.filter((c) => c.id !== activeSubChatId).slice(0, 4)
+      return activeChat ? [activeChat, ...otherChats] : openSubChats.slice(0, 5)
     }
-    return openSubChats
+    return openSubChats.slice(0, 5)
   }, [openSubChatIds, allSubChats, activeSubChatId])
 
   // Keyboard navigation: Quick switch between agents (sub-chats within workspace)
@@ -564,19 +565,19 @@ export function AgentsContent() {
 
           if (openSubChats.length === 0) return
 
-          // Put active sub-chat first
+          // Put active sub-chat first, limit to 5
           if (currentActiveId) {
             const activeChat = openSubChats.find(
               (c) => c.id === currentActiveId,
             )
             const otherChats = openSubChats.filter(
               (c) => c.id !== currentActiveId,
-            )
+            ).slice(0, 4)
             frozenSubChatsRef.current = activeChat
               ? [activeChat, ...otherChats]
-              : openSubChats
+              : openSubChats.slice(0, 5)
           } else {
-            frozenSubChatsRef.current = openSubChats
+            frozenSubChatsRef.current = openSubChats.slice(0, 5)
           }
 
           subChatHoldTimerRef.current = setTimeout(() => {
diff --git a/src/renderer/features/agents/ui/chat-title-editor.tsx b/src/renderer/features/agents/ui/chat-title-editor.tsx
index 5dd7d3b..c084697 100644
--- a/src/renderer/features/agents/ui/chat-title-editor.tsx
+++ b/src/renderer/features/agents/ui/chat-title-editor.tsx
@@ -18,7 +18,7 @@ interface ChatTitleEditorProps {
 
 export function ChatTitleEditor({
   name,
-  placeholder = "New Agent",
+  placeholder = "New Chat",
   onSave,
   isMobile = false,
   disabled = false,
diff --git a/src/renderer/features/agents/ui/mobile-chat-header.tsx b/src/renderer/features/agents/ui/mobile-chat-header.tsx
index 8239aee..bc7c33e 100644
--- a/src/renderer/features/agents/ui/mobile-chat-header.tsx
+++ b/src/renderer/features/agents/ui/mobile-chat-header.tsx
@@ -139,7 +139,7 @@ export function MobileChatHeader({
         side="bottom"
         sideOffset={8}
         getItemValue={(subChat) =>
-          `${subChat.name || "New Agent"} ${subChat.id}`
+          `${subChat.name || "New Chat"} ${subChat.id}`
         }
         renderItem={(subChat) => {
           const timeAgo = formatTimeAgo(
@@ -154,7 +154,7 @@ export function MobileChatHeader({
               )}
             >
               <span className="text-sm truncate">
-                {subChat.name || "New Agent"}
+                {subChat.name || "New Chat"}
               </span>
               <span className="text-sm text-muted-foreground whitespace-nowrap">
                 {timeAgo}
@@ -189,7 +189,7 @@ export function MobileChatHeader({
 
               {/* Name */}
               <span className="truncate text-left">
-                {activeSubChat?.name || "New Agent"}
+                {activeSubChat?.name || "New Chat"}
               </span>
 
               {/* Chevron */}
diff --git a/src/renderer/features/agents/ui/sub-chat-selector.tsx b/src/renderer/features/agents/ui/sub-chat-selector.tsx
index 4879092..a112301 100644
--- a/src/renderer/features/agents/ui/sub-chat-selector.tsx
+++ b/src/renderer/features/agents/ui/sub-chat-selector.tsx
@@ -242,7 +242,7 @@ export function SubChatSelector({
         // Revert on error (like Canvas)
         useAgentSubChatStore
           .getState()
-          .updateSubChatName(subChat.id, oldName || "New Agent")
+          .updateSubChatName(subChat.id, oldName || "New Chat")
       } finally {
         setEditLoading(false)
       }
@@ -587,7 +587,7 @@ export function SubChatSelector({
                             }}
                             className="relative z-0 text-left flex-1 min-w-0 pr-1 overflow-hidden block whitespace-nowrap"
                           >
-                            {subChat.name || "New Agent"}
+                            {subChat.name || "New Chat"}
                           </span>
                         )}
 
@@ -701,7 +701,7 @@ export function SubChatSelector({
             placeholder="Search chats..."
             emptyMessage="No results"
             getItemValue={(subChat) =>
-              `${subChat.name || "New Agent"} ${subChat.id}`
+              `${subChat.name || "New Chat"} ${subChat.id}`
             }
             renderItem={(subChat) => {
               const timeAgo = formatTimeAgo(
@@ -732,7 +732,7 @@ export function SubChatSelector({
                     )}
                   </div>
                   <span className="text-sm truncate flex-1">
-                    {subChat.name || "New Agent"}
+                    {subChat.name || "New Chat"}
                   </span>
                   <span className="text-sm text-muted-foreground whitespace-nowrap">
                     {timeAgo}
diff --git a/src/renderer/features/agents/utils/auto-rename.ts b/src/renderer/features/agents/utils/auto-rename.ts
index 5d19ab9..02900ec 100644
--- a/src/renderer/features/agents/utils/auto-rename.ts
+++ b/src/renderer/features/agents/utils/auto-rename.ts
@@ -37,7 +37,7 @@ export async function autoRenameAgentChat({
     const { name } = await generateName(userMessage)
     console.log("[auto-rename] Generated name:", name)
 
-    if (!name || name === "New Agent") {
+    if (!name || name === "New Chat") {
       console.log("[auto-rename] Skipping - generic name")
       return // Don't rename if we got a generic name
     }
diff --git a/src/renderer/features/agents/utils/paste-text.ts b/src/renderer/features/agents/utils/paste-text.ts
new file mode 100644
index 0000000..a685d66
--- /dev/null
+++ b/src/renderer/features/agents/utils/paste-text.ts
@@ -0,0 +1,63 @@
+/**
+ * Insert text at the current cursor position in a contentEditable element.
+ * Uses requestAnimationFrame for async insertion to prevent UI freeze with large text.
+ *
+ * @param text - The text to insert
+ * @param editableElement - The contentEditable element to dispatch input event to
+ */
+export function insertTextAtCursor(text: string, editableElement: Element): void {
+  // Use async insertion to prevent UI freeze with large text
+  // requestAnimationFrame allows the browser to process the paste event
+  // before we modify the DOM, preventing blocking the main thread
+  requestAnimationFrame(() => {
+    const selection = window.getSelection()
+    if (selection && selection.rangeCount > 0) {
+      const range = selection.getRangeAt(0)
+      range.deleteContents()
+      const textNode = document.createTextNode(text)
+      range.insertNode(textNode)
+      // Move cursor to end of inserted text
+      range.setStartAfter(textNode)
+      range.setEndAfter(textNode)
+      selection.removeAllRanges()
+      selection.addRange(range)
+      // Trigger input event on the contentEditable element for editor to update state
+      const inputEvent = new Event("input", { bubbles: true })
+      editableElement.dispatchEvent(inputEvent)
+    }
+  })
+}
+
+/**
+ * Handle paste event for contentEditable elements.
+ * Extracts images and passes them to handleAddAttachments.
+ * For text, pastes as plain text only (prevents HTML).
+ *
+ * @param e - The clipboard event
+ * @param handleAddAttachments - Callback to handle image attachments
+ */
+export function handlePasteEvent(
+  e: React.ClipboardEvent,
+  handleAddAttachments: (files: File[]) => void,
+): void {
+  const files = Array.from(e.clipboardData.items)
+    .filter((item) => item.type.startsWith("image/"))
+    .map((item) => item.getAsFile())
+    .filter(Boolean) as File[]
+
+  if (files.length > 0) {
+    e.preventDefault()
+    handleAddAttachments(files)
+  } else {
+    // Paste as plain text only (prevents HTML from being pasted)
+    const text = e.clipboardData.getData("text/plain")
+    if (text) {
+      e.preventDefault()
+      // Get the contentEditable element before async operation
+      const target = e.currentTarget as HTMLElement
+      const editableElement =
+        target.closest('[contenteditable="true"]') || target
+      insertTextAtCursor(text, editableElement)
+    }
+  }
+}
diff --git a/src/renderer/features/sidebar/agents-sidebar.tsx b/src/renderer/features/sidebar/agents-sidebar.tsx
index b2efd66..b582da3 100644
--- a/src/renderer/features/sidebar/agents-sidebar.tsx
+++ b/src/renderer/features/sidebar/agents-sidebar.tsx
@@ -353,18 +353,70 @@ export function AgentsSidebar({
     prevArchivePopoverOpen.current = archivePopoverOpen
   }, [archivePopoverOpen])
 
+  // Stack of archived chats for multiple Cmd+Z undos
+  const archivedStackRef = useRef<Array<{
+    chatId: string
+    timeoutId: ReturnType<typeof setTimeout>
+  }>>([])
+
+  // Restore chat mutation (for undo)
+  const restoreChatMutation = trpc.chats.restore.useMutation({
+    onSuccess: () => {
+      utils.chats.list.invalidate()
+      utils.chats.listArchived.invalidate()
+    },
+  })
+
+  // Remove item from stack by chatId
+  const removeFromStack = useCallback((chatId: string) => {
+    const index = archivedStackRef.current.findIndex((item) => item.chatId === chatId)
+    if (index !== -1) {
+      clearTimeout(archivedStackRef.current[index].timeoutId)
+      archivedStackRef.current.splice(index, 1)
+    }
+  }, [])
+
   // Archive chat mutation
   const archiveChatMutation = trpc.chats.archive.useMutation({
-    onSuccess: () => {
+    onSuccess: (_, variables) => {
       utils.chats.list.invalidate()
       utils.chats.listArchived.invalidate()
       // If archiving the currently selected chat, clear selection
       if (selectedChatId) {
         setSelectedChatId(null)
       }
+
+      // Clear after 10 seconds (Cmd+Z window)
+      const timeoutId = setTimeout(() => {
+        removeFromStack(variables.id)
+      }, 10000)
+
+      // Add to stack for Cmd+Z
+      archivedStackRef.current.push({
+        chatId: variables.id,
+        timeoutId,
+      })
     },
   })
 
+  // Cmd+Z to undo archive (supports multiple undos)
+  useEffect(() => {
+    const handleKeyDown = (e: KeyboardEvent) => {
+      if ((e.metaKey || e.ctrlKey) && e.key === "z" && archivedStackRef.current.length > 0) {
+        e.preventDefault()
+        // Pop the most recent archived item
+        const item = archivedStackRef.current.pop()
+        if (item) {
+          clearTimeout(item.timeoutId)
+          restoreChatMutation.mutate({ id: item.chatId })
+        }
+      }
+    }
+
+    window.addEventListener("keydown", handleKeyDown)
+    return () => window.removeEventListener("keydown", handleKeyDown)
+  }, [restoreChatMutation])
+
   // Batch archive mutation
   const archiveChatsBatchMutation = trpc.chats.archiveBatch.useMutation({
     onSuccess: () => {
@@ -1427,7 +1479,7 @@ export function AgentsSidebar({
                     )}
                   >
                     <h3 className="text-xs font-medium text-muted-foreground whitespace-nowrap">
-                      Pinned
+                      Pinned Workspaces
                     </h3>
                   </div>
                   <div className="list-none p-0 m-0 mb-3">
@@ -1650,7 +1702,8 @@ export function AgentsSidebar({
                                     onClick={() => {
                                       navigator.clipboard.writeText(branch)
                                       toast.success(
-                                        "Branch name copied to clipboard",
+                                        "Branch name copied",
+                                        { description: branch },
                                       )
                                     }}
                                   >
@@ -1706,7 +1759,7 @@ export function AgentsSidebar({
                     )}
                   >
                     <h3 className="text-xs font-medium text-muted-foreground whitespace-nowrap">
-                      {pinnedAgents.length > 0 ? "Recent" : "Workspaces"}
+                      {pinnedAgents.length > 0 ? "Recent workspaces" : "Workspaces"}
                     </h3>
                   </div>
                   <div className="list-none p-0 m-0">
@@ -1932,7 +1985,8 @@ export function AgentsSidebar({
                                     onClick={() => {
                                       navigator.clipboard.writeText(branch)
                                       toast.success(
-                                        "Branch name copied to clipboard",
+                                        "Branch name copied",
+                                        { description: branch },
                                       )
                                     }}
                                   >
diff --git a/src/renderer/features/sidebar/agents-subchats-sidebar.tsx b/src/renderer/features/sidebar/agents-subchats-sidebar.tsx
index f1a70e6..ef19f76 100644
--- a/src/renderer/features/sidebar/agents-subchats-sidebar.tsx
+++ b/src/renderer/features/sidebar/agents-subchats-sidebar.tsx
@@ -452,7 +452,7 @@ export function AgentsSubChatsSidebar({
         // Rollback on error
         useAgentSubChatStore
           .getState()
-          .updateSubChatName(subChatId, oldName || "New Agent")
+          .updateSubChatName(subChatId, oldName || "New Chat")
       } finally {
         setRenameLoading(false)
         setRenamingSubChat(null)
@@ -469,7 +469,7 @@ export function AgentsSubChatsSidebar({
     // Create sub-chat in DB first to get the real ID
     const newSubChat = await trpcClient.chats.createSubChat.mutate({
       chatId: parentChatId,
-      name: "New Agent",
+      name: "New Chat",
       mode: "agent",
     })
     const newId = newSubChat.id
@@ -480,7 +480,7 @@ export function AgentsSubChatsSidebar({
     // Add to allSubChats with placeholder name
     store.addToAllSubChats({
       id: newId,
-      name: "New Agent",
+      name: "New Chat",
       created_at: new Date().toISOString(),
       mode: "agent",
     })
@@ -762,7 +762,7 @@ export function AgentsSubChatsSidebar({
         placeholder="Search chats..."
         emptyMessage="No results"
         getItemValue={(subChat) =>
-          `${subChat.name || "New Agent"} ${subChat.id}`
+          `${subChat.name || "New Chat"} ${subChat.id}`
         }
         renderItem={(subChat) => {
           const timeAgo = formatTimeAgo(
@@ -793,7 +793,7 @@ export function AgentsSubChatsSidebar({
                 )}
               </div>
               <span className="text-sm truncate flex-1">
-                {subChat.name || "New Agent"}
+                {subChat.name || "New Chat"}
               </span>
               <span className="text-sm text-muted-foreground whitespace-nowrap">
                 {timeAgo}
@@ -1028,7 +1028,7 @@ export function AgentsSubChatsSidebar({
                         )}
                       >
                         <h3 className="text-xs font-medium text-muted-foreground whitespace-nowrap">
-                          Pinned
+                          Pinned Chats
                         </h3>
                       </div>
                       <div className="list-none p-0 m-0 mb-3">
@@ -1092,7 +1092,7 @@ export function AgentsSubChatsSidebar({
                                     setHoveredChatIndex(globalIndex)
                                     handleSubChatMouseEnter(
                                       subChat.id,
-                                      subChat.name || "New Agent",
+                                      subChat.name || "New Chat",
                                       e.currentTarget,
                                     )
                                   }}
@@ -1185,7 +1185,7 @@ export function AgentsSubChatsSidebar({
                                         >
                                           <TypewriterText
                                             text={subChat.name || ""}
-                                            placeholder="New Agent"
+                                            placeholder="New Chat"
                                             id={subChat.id}
                                             isJustCreated={justCreatedIds.has(subChat.id)}
                                             showPlaceholder={true}
@@ -1301,7 +1301,7 @@ export function AgentsSubChatsSidebar({
                         )}
                       >
                         <h3 className="text-xs font-medium text-muted-foreground whitespace-nowrap">
-                          {pinnedChats.length > 0 ? "Recent" : "Chats"}
+                          {pinnedChats.length > 0 ? "Recent chats" : "Chats"}
                         </h3>
                       </div>
                       <div className="list-none p-0 m-0">
@@ -1365,7 +1365,7 @@ export function AgentsSubChatsSidebar({
                                     setHoveredChatIndex(globalIndex)
                                     handleSubChatMouseEnter(
                                       subChat.id,
-                                      subChat.name || "New Agent",
+                                      subChat.name || "New Chat",
                                       e.currentTarget,
                                     )
                                   }}
@@ -1458,7 +1458,7 @@ export function AgentsSubChatsSidebar({
                                         >
                                           <TypewriterText
                                             text={subChat.name || ""}
-                                            placeholder="New Agent"
+                                            placeholder="New Chat"
                                             id={subChat.id}
                                             isJustCreated={justCreatedIds.has(subChat.id)}
                                             showPlaceholder={true}
diff --git a/src/renderer/features/sub-chats/sub-chat-selector.tsx b/src/renderer/features/sub-chats/sub-chat-selector.tsx
index 7d76773..42e4b06 100644
--- a/src/renderer/features/sub-chats/sub-chat-selector.tsx
+++ b/src/renderer/features/sub-chats/sub-chat-selector.tsx
@@ -246,7 +246,7 @@ export function SubChatSelector({
         // Revert on error (like Canvas)
         useAgentSubChatStore
           .getState()
-          .updateSubChatName(subChat.id, oldName || "New Agent")
+          .updateSubChatName(subChat.id, oldName || "New Chat")
       } finally {
         setEditLoading(false)
       }
@@ -586,7 +586,7 @@ export function SubChatSelector({
                             }}
                             className="relative z-0 text-left flex-1 min-w-0 pr-1 overflow-hidden block whitespace-nowrap"
                           >
-                            {subChat.name || "New Agent"}
+                            {subChat.name || "New Chat"}
                           </span>
                         )}
 
@@ -700,7 +700,7 @@ export function SubChatSelector({
             placeholder="Search chats..."
             emptyMessage="No results"
             getItemValue={(subChat) =>
-              `${subChat.name || "New Agent"} ${subChat.id}`
+              `${subChat.name || "New Chat"} ${subChat.id}`
             }
             renderItem={(subChat) => {
               const timeAgo = formatTimeAgo(
@@ -709,7 +709,7 @@ export function SubChatSelector({
               return (
                 <div className="flex items-center gap-2 flex-1 min-w-0">
                   <span className="text-sm truncate">
-                    {subChat.name || "New Agent"}
+                    {subChat.name || "New Chat"}
                   </span>
                   <span className="text-sm text-muted-foreground whitespace-nowrap">
                     {timeAgo}
diff --git a/src/renderer/features/sub-chats/sub-chats-sidebar.tsx b/src/renderer/features/sub-chats/sub-chats-sidebar.tsx
index a4221a8..7319cd3 100644
--- a/src/renderer/features/sub-chats/sub-chats-sidebar.tsx
+++ b/src/renderer/features/sub-chats/sub-chats-sidebar.tsx
@@ -354,7 +354,7 @@ export function SubChatsSidebar({
     // Add to allSubChats with placeholder name
     store.addToAllSubChats({
       id: newId,
-      name: "New Agent",
+      name: "New Chat",
       created_at: new Date().toISOString(),
       mode: "agent",
     })
@@ -520,7 +520,7 @@ export function SubChatsSidebar({
         placeholder="Search chats..."
         emptyMessage="No results"
         getItemValue={(subChat) =>
-          `${subChat.name || "New Agent"} ${subChat.id}`
+          `${subChat.name || "New Chat"} ${subChat.id}`
         }
         renderItem={(subChat) => {
           const timeAgo = formatTimeAgo(
@@ -529,7 +529,7 @@ export function SubChatsSidebar({
           return (
             <div className="flex items-center gap-2 flex-1 min-w-0">
               <span className="text-sm truncate">
-                {subChat.name || "New Agent"}
+                {subChat.name || "New Chat"}
               </span>
               <span className="text-sm text-muted-foreground whitespace-nowrap">
                 {timeAgo}
@@ -616,7 +616,7 @@ export function SubChatsSidebar({
               setHoveredChatIndex(globalIndex)
               handleSubChatMouseEnter(
                 subChat.id,
-                subChat.name || "New Agent",
+                subChat.name || "New Chat",
                 e.currentTarget,
               )
             }}
@@ -684,7 +684,7 @@ export function SubChatsSidebar({
                     }}
                     className="truncate block text-sm leading-tight flex-1"
                   >
-                    {subChat.name || "New Agent"}
+                    {subChat.name || "New Chat"}
                   </span>
                   {!isMultiSelectMode && (
                     <button
diff --git a/src/renderer/lib/api-fetch.ts b/src/renderer/lib/api-fetch.ts
index 3096570..846c3e6 100644
--- a/src/renderer/lib/api-fetch.ts
+++ b/src/renderer/lib/api-fetch.ts
@@ -10,7 +10,7 @@ let cachedBaseUrl: string | null = null
 
 /**
  * Get the API base URL (cached after first call)
- * Returns https://21st.dev in production, http://localhost:3000 in dev
+ * Always returns https://21st.dev (both in dev and production)
  */
 export async function getApiBaseUrl(): Promise<string> {
   if (cachedBaseUrl) return cachedBaseUrl
diff --git a/src/renderer/styles/globals.css b/src/renderer/styles/globals.css
index f45f374..8b36a69 100644
--- a/src/renderer/styles/globals.css
+++ b/src/renderer/styles/globals.css
@@ -185,6 +185,128 @@
   );
 }
 
+/* Sonner Toast Styling - Google-style layout */
+[data-sonner-toaster] {
+  --normal-bg: hsl(var(--popover));
+  --normal-text: hsl(var(--popover-foreground));
+  --normal-border: hsl(var(--border));
+  --border-radius: var(--radius);
+  /* Override rich colors - all toasts should be neutral */
+  --success-bg: hsl(var(--popover));
+  --success-border: hsl(var(--border));
+  --success-text: hsl(var(--popover-foreground));
+  --info-bg: hsl(var(--popover));
+  --info-border: hsl(var(--border));
+  --info-text: hsl(var(--popover-foreground));
+  --warning-bg: hsl(var(--popover));
+  --warning-border: hsl(var(--border));
+  --warning-text: hsl(var(--popover-foreground));
+  --error-bg: hsl(var(--popover));
+  --error-border: hsl(var(--border));
+  --error-text: hsl(var(--popover-foreground));
+}
+
+[data-sonner-toast][data-styled="true"] {
+  padding: 12px 16px;
+  padding-right: 32px;
+  gap: 8px;
+  align-items: flex-start;
+  flex-wrap: wrap;
+  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
+}
+
+/* Icon on the left */
+[data-sonner-toast] [data-icon] {
+  margin-top: 1px;
+  color: hsl(var(--muted-foreground));
+  width: 16px;
+  height: 16px;
+}
+
+[data-sonner-toast] [data-icon] svg {
+  width: 16px;
+  height: 16px;
+}
+
+/* Loading spinner - match icon size */
+[data-sonner-toast] .sonner-loading-wrapper {
+  --size: 16px;
+}
+
+[data-sonner-toast] .sonner-loading-bar {
+  background: hsl(var(--muted-foreground));
+}
+
+/* Content wrapper - take remaining space */
+[data-sonner-toast] [data-content] {
+  flex: 1;
+  min-width: 0;
+}
+
+/* Title styling */
+[data-sonner-toast] [data-title] {
+  font-weight: 500;
+  font-size: 14px;
+  line-height: 1.4;
+}
+
+/* Description styling */
+[data-sonner-toast] [data-description] {
+  color: hsl(var(--muted-foreground));
+  font-size: 13px;
+  line-height: 1.4;
+}
+
+/* Action button - on its own row at the bottom right */
+[data-sonner-toast][data-styled="true"] [data-button] {
+  position: absolute;
+  bottom: 12px;
+  right: 8px;
+  background: transparent !important;
+  color: hsl(var(--foreground)) !important;
+  font-weight: 500;
+  font-size: 13px;
+  padding: 4px 12px;
+  height: auto;
+  border: 1px solid hsl(var(--border)) !important;
+  border-radius: 6px;
+  margin: 0 !important;
+  transition: background-color 150ms ease-out, transform 150ms ease-out;
+}
+
+[data-sonner-toast][data-styled="true"] [data-button]:hover {
+  background: hsl(var(--foreground) / 0.1) !important;
+}
+
+[data-sonner-toast][data-styled="true"] [data-button]:active {
+  transform: scale(0.97);
+}
+
+/* Add bottom padding when button exists */
+[data-sonner-toast][data-styled="true"]:has([data-button]) {
+  padding-bottom: 44px;
+}
+
+/* Close button - inside toast, top right corner */
+[data-sonner-toast] [data-close-button] {
+  position: absolute !important;
+  top: 8px !important;
+  right: 8px !important;
+  left: unset !important;
+  transform: none !important;
+  background: transparent !important;
+  border: none !important;
+  border-radius: 4px !important;
+  color: hsl(var(--muted-foreground));
+  width: 20px;
+  height: 20px;
+}
+
+[data-sonner-toast] [data-close-button]:hover {
+  color: hsl(var(--foreground));
+  background: hsl(var(--accent)) !important;
+}
+
 /* Terminal link popup */
 .xterm-link-popup {
   font-family: var(--font-geist-mono), "Geist Mono", ui-monospace, monospace;
